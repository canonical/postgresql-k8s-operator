[33mWARNING [0m juju.client.connection:connection.py:858 unexpected facade SSHServer received from the controller
[32mINFO    [0m pytest_operator.plugin:plugin.py:795 Connecting to existing model concierge-microk8s:testing on unspecified cloud
[33mWARNING [0m juju.client.connection:connection.py:858 unexpected facade SSHServer received from the controller
[33mWARNING [0m juju.client.connection:connection.py:858 unexpected facade SSHSession received from the controller
[33mWARNING [0m juju.client.connection:connection.py:858 unexpected facade SSHTunneler received from the controller
[33mWARNING [0m juju.client.connection:connection.py:858 unexpected facade SSHServer received from the controller
[32mINFO    [0m juju.model:__init__.py:2301 Deploying ch:amd64/jammy/s3-integrator-145
[32mINFO    [0m juju.model:__init__.py:2301 Deploying ch:amd64/jammy/self-signed-certificates-264
[32mINFO    [0m juju.model:__init__.py:2301 Deploying local:postgresql-k8s-0
[33mWARNING [0m juju.model:__init__.py:1683 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [allocating] waiting: installing agent
  postgresql-k8s-aws/1 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [allocating] waiting: agent initialising
  postgresql-k8s-aws/1 [allocating] waiting: agent initialising
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] unknown: 
  postgresql-k8s-aws/1 [idle] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] unknown: 
  postgresql-k8s-aws/1 [idle] waiting: awaiting for primary endpoint to be ready
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] unknown: 
  postgresql-k8s-aws/1 [executing] active: Primary (degraded)
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] waiting: awaiting for cluster to start
  postgresql-k8s-aws/1 [idle] active: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] waiting: awaiting for cluster to start
  postgresql-k8s-aws/1 [idle] active: Primary (degraded)
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] waiting: awaiting for cluster to start
  postgresql-k8s-aws/1 [idle] maintenance: reconfiguring cluster
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] waiting: awaiting for member to start
  postgresql-k8s-aws/1 [idle] active: Primary (degraded)
[33mWARNING [0m juju.model:__init__.py:1683 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m integration.helpers:helpers.py:861 configuring S3 integrator for AWS
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [executing] active: Primary
  s3-integrator/0 [executing] blocked: Missing parameters: ['access-key', 'secret-key']
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [executing] maintenance: initialising stanza
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [executing] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] maintenance: initialising stanza
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/1 [idle] maintenance: initialising stanza
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:882 creating a table in the database
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:893 creating a backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [executing] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:902 listing the available backups
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:911 creating a second table in the database
[32mINFO    [0m integration.helpers:helpers.py:918 creating a backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:929 listing the available backups
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:938 creating a second table in the database
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws (waiting for exactly 1 units, current : 2)
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws (waiting for exactly 1 units, current : 2)
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: initialising stanza
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:954 restoring the backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [executing] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:967 checking that the backup was correctly restored
[32mINFO    [0m integration.helpers:helpers.py:999 restoring the backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  s3-integrator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
  postgresql-k8s-aws/0 [executing] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: restoring backup
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: Primary
[32mINFO    [0m integration.helpers:helpers.py:1012 checking that the backup was correctly restored
[32mINFO    [0m integration.test_backups_aws:test_backups_aws.py:61 removing the TLS relation
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws (waiting for exactly 2 units, current : 1)
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] active: 
  postgresql-k8s-aws/1 [idle] maintenance: installing charm software
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  postgresql-k8s-aws/0 [idle] maintenance: reconfiguring cluster
  postgresql-k8s-aws/1 [idle] waiting: awaiting for cluster to start
[32mINFO    [0m integration.conftest:conftest.py:54 deleting the previously created backups
[32mINFO    [0m pytest_operator.plugin:plugin.py:937 Model status:

Model    Controller          Cloud/Region        Version  SLA          Timestamp
testing  concierge-microk8s  microk8s/localhost  3.6.5    unsupported  01:52:38Z

App                       Version  Status   Scale  Charm                     Channel        Rev  Address         Exposed  Message
postgresql-k8s-aws        14.17    waiting      2  postgresql-k8s                             0  10.152.183.37   no       installing agent
s3-integrator                      active       1  s3-integrator             latest/stable  145  10.152.183.149  no       
self-signed-certificates           active       1  self-signed-certificates  latest/stable  264  10.152.183.93   no       

Unit                         Workload  Agent      Address       Ports  Message
postgresql-k8s-aws/0*        active    executing  10.1.219.140         Primary
postgresql-k8s-aws/1         error     idle       10.1.219.142         hook failed: "config-changed"
s3-integrator/0*             active    idle       10.1.219.136         
self-signed-certificates/0*  active    idle       10.1.219.137         

[32mINFO    [0m pytest_operator.plugin:plugin.py:943 Juju error logs:

unit-postgresql-k8s-aws-0: 01:47:44 ERROR juju.worker.dependency "log-sender" manifold worker returned unexpected error: sending log message: websocket: close 1005 (no status): websocket: close sent
unit-self-signed-certificates-0: 01:47:48 ERROR juju.worker.dependency "log-sender" manifold worker returned unexpected error: sending log message: websocket: close 1005 (no status): websocket: close sent
unit-s3-integrator-0: 01:47:53 ERROR juju.worker.dependency "log-sender" manifold worker returned unexpected error: sending log message: websocket: close 1005 (no status): websocket: close sent
unit-postgresql-k8s-aws-1: 01:52:33 ERROR unit.postgresql-k8s-aws/1.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 579, in get_postgresql_timezones
    cursor.execute("SELECT name FROM pg_timezone_names;")
psycopg2.OperationalError: terminating connection due to administrator command
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/src/charm.py", line 2520, in <module>
    main(PostgresqlOperatorCharm, use_juju_for_storage=True)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/__init__.py", line 347, in __call__
    return _main.main(charm_class=charm_class, use_juju_for_storage=use_juju_for_storage)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/_main.py", line 565, in main
    manager.run()
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/_main.py", line 550, in run
    self._emit()
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/_main.py", line 502, in _emit
    self._emit_charm_event(self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/_main.py", line 537, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 907, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 997, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1109, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/src/charm.py", line 714, in _on_config_changed
    self._validate_config_options()
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1109, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/src/charm.py", line 2147, in _validate_config_options
    if self.config.request_time_zone not in self.postgresql.get_postgresql_timezones():
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1109, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-postgresql-k8s-aws-1/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 576, in get_postgresql_timezones
    with self._connect_to_database(
psycopg2.InterfaceError: connection already closed
unit-postgresql-k8s-aws-1: 01:52:33 ERROR juju.worker.uniter.operation hook "config-changed" (via hook dispatching script: dispatch) failed: exit status 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:1025 Forgetting model main...