[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/1 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/2 [executing] blocked: Insufficient permissions, try: `juju trust untrusted-postgresql-k8s --scope=cluster`
[31m[1mERROR   [0m asyncio:base_events.py:1821 Task exception was never retrieved
future: <Task finished name='Task-266' coro=<Connection._connect.<locals>._try_endpoint() done, defined at /root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py:727> exception=OSError(9, 'Bad file descriptor')>
Traceback (most recent call last):
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 732, in _try_endpoint
    return await self._open(endpoint, cacert)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 333, in _open
    await websockets.connect(
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/client.py", line 444, in __await_impl__
    self.connection = await self.create_connection()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/spread_project/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/client.py", line 370, in create_connection
    _, connection = await loop.create_connection(factory, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1149, in create_connection
    transport, protocol = await self._create_connection_transport(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1167, in _create_connection_transport
    sock.setblocking(False)
OSError: [Errno 9] Bad file descriptor
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] unknown: 
  untrusted-postgresql-k8s/1 [executing] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for primary endpoint to be ready
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/2 [idle] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/2 [idle] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/2 [idle] maintenance: reconfiguring cluster
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] waiting: awaiting for member to start
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/2 [idle] maintenance: reconfiguring cluster
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] active: 
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for member to start
  untrusted-postgresql-k8s/2 [idle] active: Primary
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] active:
[32mINFO    [0m pytest_operator.plugin:plugin.py:929 Model status:

Model    Controller          Cloud/Region        Version  SLA          Timestamp
testing  concierge-microk8s  microk8s/localhost  3.6.2    unsupported  01:43:45Z

App                       Version  Status  Scale  Charm           Channel  Rev  Address         Exposed  Message
untrusted-postgresql-k8s  14.15    active      3  postgresql-k8s             0  10.152.183.236  no       

Unit                         Workload  Agent  Address      Ports  Message
untrusted-postgresql-k8s/0   active    idle   10.1.204.75         
untrusted-postgresql-k8s/1   active    idle   10.1.204.77         
untrusted-postgresql-k8s/2*  active    idle   10.1.204.76         Primary

[32mINFO    [0m pytest_operator.plugin:plugin.py:935 Juju error logs:

unit-untrusted-postgresql-k8s-2: 01:39:25 ERROR unit.untrusted-postgresql-k8s/2.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-2: 01:39:25 ERROR unit.untrusted-postgresql-k8s/2.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-2: 01:39:28 ERROR unit.untrusted-postgresql-k8s/2.juju-log failed to create k8s services
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 299, in raise_for_status
    resp.raise_for_status()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '403 Forbidden' for url 'https://10.152.183.1/api/v1/namespaces/testing/services/untrusted-postgresql-k8s-primary?force=true&fieldManager=untrusted-postgresql-k8s'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/src/charm.py", line 1304, in _fix_pod
    self._create_services()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1065, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/src/charm.py", line 1153, in _create_services
    client.apply(
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/lightkube/core/client.py", line 757, in apply
    return self.patch(
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/lightkube/core/client.py", line 492, in patch
    return self._client.request(
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 383, in request
    return self.handle_response(method, resp, br)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 315, in handle_response
    self.raise_for_status(resp)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 301, in raise_for_status
    raise transform_exception(e)
lightkube.core.exceptions.ApiError: services "untrusted-postgresql-k8s-primary" is forbidden: User "system:serviceaccount:testing:untrusted-postgresql-k8s" cannot create resource "services" in API group "" in the namespace "testing"
unit-untrusted-postgresql-k8s-2: 01:39:28 ERROR unit.untrusted-postgresql-k8s/2.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            

[32mINFO    [0m pytest_operator.plugin:plugin.py:1017 Forgetting model main...