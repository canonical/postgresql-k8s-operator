[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/1 [allocating] waiting: installing agent
  untrusted-postgresql-k8s/2 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] blocked: Insufficient permissions, try: `juju trust untrusted-postgresql-k8s --scope=cluster`
  untrusted-postgresql-k8s/1 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/2 [executing] maintenance: installing charm software
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] waiting: awaiting for primary endpoint to be ready
  untrusted-postgresql-k8s/1 [executing] unknown: 
  untrusted-postgresql-k8s/2 [executing] unknown: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] waiting: awaiting for primary endpoint to be ready
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] waiting: awaiting for primary endpoint to be ready
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] active: Primary (degraded)
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] maintenance: reconfiguring cluster
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for member to start
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] active: Primary
  untrusted-postgresql-k8s/1 [idle] maintenance: Executing restart operation
  untrusted-postgresql-k8s/2 [idle] waiting: Awaiting restart operation
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] active: Primary
  untrusted-postgresql-k8s/1 [idle] active: 
  untrusted-postgresql-k8s/2 [idle] active:
[32mINFO    [0m pytest_operator.plugin:plugin.py:951 Model status:

Model    Controller          Cloud/Region        Version  SLA          Timestamp
testing  concierge-microk8s  microk8s/localhost  3.6.14   unsupported  01:35:36Z

App                       Version  Status  Scale  Charm           Channel  Rev  Address         Exposed  Message
untrusted-postgresql-k8s  16.11    active      3  postgresql-k8s             0  10.152.183.181  no       

Unit                         Workload  Agent  Address      Ports  Message
untrusted-postgresql-k8s/0*  active    idle   10.1.119.15         Primary
untrusted-postgresql-k8s/1   active    idle   10.1.119.24         
untrusted-postgresql-k8s/2   active    idle   10.1.119.22         

[32mINFO    [0m pytest_operator.plugin:plugin.py:957 Juju error logs:

unit-untrusted-postgresql-k8s-0: 01:31:34 ERROR unit.untrusted-postgresql-k8s/0.juju-log __main__:
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-0: 01:31:34 ERROR unit.untrusted-postgresql-k8s/0.juju-log __main__:
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-0: 01:31:37 ERROR unit.untrusted-postgresql-k8s/0.juju-log __main__:
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-0: 01:31:38 ERROR unit.untrusted-postgresql-k8s/0.juju-log __main__:
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-0: 01:31:39 ERROR unit.untrusted-postgresql-k8s/0.juju-log root:Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/src/charm.py", line 3080, in <module>
    main(PostgresqlOperatorCharm, use_juju_for_storage=True)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/__init__.py", line 360, in __call__
    return _main.main(charm_class=charm_class, use_juju_for_storage=use_juju_for_storage)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/_main.py", line 507, in main
    manager.run()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/_main.py", line 491, in run
    self._emit()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/_main.py", line 426, in _emit
    self._emit_charm_event(self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/_main.py", line 470, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/framework.py", line 337, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/framework.py", line 910, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/framework.py", line 1028, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 946, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/src/charm.py", line 1229, in _on_postgresql_pebble_ready
    self._update_pebble_layers()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 946, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/src/charm.py", line 2706, in _update_pebble_layers
    self._container.replan()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/model.py", line 2594, in replan
    self._pebble.replan_services()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/pebble.py", line 2326, in replan_services
    return self._services_action('replan', [], timeout, delay)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-0/charm/venv/lib/python3.12/site-packages/ops/pebble.py", line 2428, in _services_action
    raise ChangeError(change.err, change)
ops.pebble.ChangeError: cannot perform the following tasks:
- Start service "postgresql" (service start attempt: exited quickly with code 1, will restart)
----- Logs from task 0 -----
2026-02-17T01:31:39Z INFO Most recent service output:
    Traceback (most recent call last):
      File "/usr/bin/patroni", line 33, in <module>
        sys.exit(load_entry_point('patroni==3.3.8', 'console_scripts', 'patroni')())
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3/dist-packages/patroni/__main__.py", line 358, in main
        return patroni_main(args.configfile)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3/dist-packages/patroni/__main__.py", line 246, in patroni_main
        abstract_main(Patroni, configfile)
      File "/usr/lib/python3/dist-packages/patroni/daemon.py", line 172, in abstract_main
        controller = cls(config)
                     ^^^^^^^^^^^
      File "/usr/lib/python3/dist-packages/patroni/__main__.py", line 76, in __init__
        self.postgresql = Postgresql(self.config['postgresql'], self.dcs.mpp)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3/dist-packages/patroni/postgresql/__init__.py", line 69, in __init__
        self._data_dir: str = config['data_dir']
                              ~~~~~~^^^^^^^^^^^^
    KeyError: 'data_dir'
2026-02-17T01:31:39Z ERROR service start attempt: exited quickly with code 1, will restart
-----
unit-untrusted-postgresql-k8s-0: 01:31:39 ERROR juju.worker.uniter.operation hook "postgresql-pebble-ready" (via hook dispatching script: dispatch) failed: exit status 1
unit-untrusted-postgresql-k8s-0: 01:31:39 ERROR juju.worker.uniter pebble poll failed for container "postgresql": failed to send pebble-ready event: hook failed

[32mINFO    [0m pytest_operator.plugin:plugin.py:1039 Forgetting model main...